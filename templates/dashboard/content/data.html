<main class="h-full overflow-y-auto">
  <div class="container px-6 mx-auto grid">
    <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">
      {{ title }}
    </h2>

    {% if error_message %}
    <div
      class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-gray-900 dark:text-red-300"
      role="alert"
    >
      <span class="font-medium">¡Atención!</span> {{ error_message }}
    </div>
    {% endif %}

    <div class="grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4">
      <div
        class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800"
      >
        <div
          class="p-3 mr-4 text-orange-500 bg-orange-100 rounded-full dark:text-orange-100 dark:bg-orange-500"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"
            ></path>
          </svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">
            Total de Posts
          </p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
            {{ total_responses }}
          </p>
        </div>
      </div>
      <div
        class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800"
      >
        <div
          class="p-3 mr-4 text-green-500 bg-green-100 rounded-full dark:text-green-100 dark:bg-green-500"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">
            Usuarios Únicos
          </p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
            {{ total_unique_users }}
          </p>
        </div>
      </div>
      <div
        class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800"
      >
        <div
          class="p-3 mr-4 text-blue-500 bg-blue-100 rounded-full dark:text-blue-100 dark:bg-blue-500"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"
            ></path>
            <path
              fill-rule="evenodd"
              d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">
            Promedio de Longitud de Titulo
          </p>
          <p class="text-lg font-semibold text-gray-700 dark:text-gray-200">
            {{ avg_title_length }}
          </p>
        </div>
      </div>
      <div
        class="flex items-center p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800"
      >
        <div
          class="p-3 mr-4 text-teal-500 bg-teal-100 rounded-full dark:text-teal-100 dark:bg-teal-500"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd"
            ></path>
          </svg>
        </div>
        <div>
          <p class="mb-2 text-sm font-medium text-gray-600 dark:text-gray-400">
            Estado de la API
          </p>
          <p
            class="text-lg font-semibold {% if error_message %}text-red-500{% else %}text-green-500{% endif %} dark:text-gray-200"
          >
            {% if error_message %}Error{% else %}OK{% endif %}
          </p>
        </div>
      </div>
    </div>

    <div class="grid gap-6 mb-8 md:grid-cols-2">
      <div class="w-full overflow-hidden rounded-lg shadow-xs">
        <div class="w-full overflow-x-auto">
          <table class="w-full whitespace-no-wrap">
            <thead>
              <tr
                class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800"
              >
                <th class="px-4 py-3">Usuario</th>
                <th class="px-4 py-3">Título del Post</th>
              </tr>
            </thead>
            <tbody
              class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800"
            >
              {% for post in posts %}
              <tr
                class="{% if forloop.counter|divisibleby:2 %}bg-gray-50 dark:bg-gray-900{% endif %} text-gray-700 dark:text-gray-400"
              >
                <td class="px-4 py-3 text-sm">
                  {% if post.userId == 1 %}
                  <span
                    class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100"
                    >Admin</span
                  >
                  {% else %} Usuario {{ post.userId }} {% endif %}
                </td>
                <td class="px-4 py-3 text-sm">
                  {{ post.title|truncatechars:40 }}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="2" class="px-4 py-3 text-center">
                  No hay datos para mostrar.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div
          class="grid px-4 py-3 text-xs font-semibold tracking-wide text-gray-500 uppercase border-t dark:border-gray-700 bg-gray-50 sm:grid-cols-9 dark:text-gray-400 dark:bg-gray-800"
        >
          <span class="flex items-center col-span-3"
            >Mostrando {{ posts|length }} de {{ total_responses }}
            registros</span
          >
        </div>
      </div>

      <div class="min-w-0 p-4 bg-white rounded-lg shadow-xs dark:bg-gray-800">
        <h4 class="mb-4 font-semibold text-gray-800 dark:text-gray-300">
          Posts por Usuario
        </h4>
        <canvas id="line"></canvas>
        <script>
          document.addEventListener("DOMContentLoaded", function() {
            const lineConfig = {
              type: 'line',
              data: {
                labels: {{ chart_labels|safe }},
                datasets: [{
                  label: 'Número de Posts',
                  backgroundColor: 'rgba(126, 58, 242, 0.2)',
                  borderColor: '#7e3af2',
                  data: {{ chart_data|safe }},
                  fill: true,
                }],
              },
              options: {
                responsive: true,
                legend: { display: false },
                scales: {
                  yAxes: [{ ticks: { beginAtZero: true, stepSize: 1 } }]
                },
              }
            };
            const lineCtx = document.getElementById('line');
            if(lineCtx) { window.myLine = new Chart(lineCtx, lineConfig); }
          });
        </script>
      </div>
    </div>
  </div>
</main>

